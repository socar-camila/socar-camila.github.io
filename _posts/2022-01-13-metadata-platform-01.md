---
layout: post
title:  "쏘카의 메타데이터 플랫폼 도입기 - 1편. 메타데이터 플랫폼이란? "
subtitle: feat. Datahub VS Amundsen 비교분석
date: 2022-01-12 17:00:00 +0900
category: data
background : "/assets/images/onboarding-bg.jpg"
author: dini
comments: true
tags:
    - data
    - data-engineering
---

안녕하세요, 쏘카 데이터엔지니어링 그룹, 데이터플랫폼팀의 디니입니다. 

여러분, 혹시 도서관에서 가서 책을 찾아보신 경험이 있으신가요? 방대한 도서관에서 원하는 책을 찾으려면 책의 제목, 저자, 분류 기호 같은 정보가 매우 중요하죠. 이런 정보가 없다면 책을 찾기가 많이 힘들어질 겁니다. 

회사의 데이터베이스에서 원하는 데이터를 찾으려고 할때도 비슷한 일이 발생합니다. 어느 데이터가 어디에 있는지, 이 데이터는 무슨 의미인지에 대한 안내가 없으면 데이터를 이용하기가 불편할 것입니다. 이 "데이터에 대한 데이터" 가 바로 메타데이터이며, 메타데이터에 대한 안내 역할을 하는 플랫폼이 "메타데이터 플랫폼"입니다.

앞으로 3부에 걸쳐 쏘카의 메타데이터 플랫폼 도입기를 소개하려고 합니다. 그 중 1부인 이 글에서는 메타데이터가 뭔지, 메타데이터 플랫폼은 왜 필요한지, 쏘카는 어떤 기준으로 메타데이터 플랫폼을 선택했는지를 담으려고 합니다. 다음과 같은 분들이 읽으시면 도움이 되리라 생각합니다.

* 메타데이터 / 데이터 디스커버리 플랫폼 도입에 관심이 있는 분
* Datahub, Amundsen 등의 메타데이터 플랫폼을 PoC 하고 있는 개발자
* 쏘카가 메타데이터 관리를 어떻게 하고 있는지 궁금하신 분  

목차는 이렇습니다. 

1. 메타데이터란 무엇인가요?
2. 메타데이터 플랫폼이 왜 필요한가요?
3. 메타데이터 플랫폼 비교분석 : Datahub VS Amundsen 
4. 최종 결정 : Datahub 결정 이유
5. 마무리 & 다음편 예고

# 1. 메타데이터란 무엇인가요?  (10%)

## 메타데이터의 정의

메타데이터는 "데이터에 대한 데이터"를 말합니다. 사내에서는 여러 데이터베이스가 있고, 각 데이터베이스 안에는 수많은 테이블이 있습니다. 각 테이블 안에는 또 수많은 칼럼이 있습니다. 이 칼럼에는 또 지정된 데이터 타입이 있고, 실제 데이터가 있을 것입니다. 또한, 이런 테이블이나 칼럼의 의미를 설명해주는 코멘트 (description) 이 있을 것입니다.  메타데이터는 이런 테이블 정보, 칼럼 정보, 코멘트 정보 등을 모두 포함합니다. 여기에 테이블을 만든 사람(오너), 테이블 사이의 관계 (데이터 리니지) 등도 포함하기도 합니다. 

(뭔가 도식화가 있으면 좋을 듯)

## 메타데이터의 중요성

원하는 데이터를 찾거나 인사이트를 얻으려고 할 때 메타데이터는 매우 중요합니다. 사내에서는 매우 다양한 데이터가 존재하고, 여러 배경의 사람들이 이런 데이터를 분석, 기획 등의 업무에 이용하려고 합니다. 하지만, 실제로 업무에 이용하기도 전에 "어떤 데이터를 어디서 찾아야 하는지", 혹은 "이 테이블의 데이터가 어떤 의미인지"를 파악하는 데에 대부분의 시간을 소요하게 된다면, 업무의 효율성이 매우 떨어지게 될 것입니다. 메타데이터가 잘 관리된다면, 이런 비효율성을 피할 수 있습니다.

# 2. 메타데이터 플랫폼이 왜 필요한가요? (10%) 

## 메타데이터 플랫폼의 정의

메타데이터를 한 곳에서 쉽게 보고 검색할 수 있는 플랫폼입니다. 시중에는 다음과 같은 플랫폼 들이 있습니다. 

* [Datahub](https://github.com/linkedin/datahub) : LinkedIn 에서 만든 메타데이터 플랫폼입니다.
* [Amundsen](https://github.com/amundsen-io/amundsen) :  [LF AI & Data Foundation](https://lfaidata.foundation/) 라는 단체에서 만든 메타데이터 플랫폼입니다.
* Databook : Uber에서 만든 인하우스 메타데이터 플랫폼 입니다.

## 메타데이터 플랫폼 도입 효과

### Data Discovery 의 관점 

쏘카에서도 PM, 마케터, 분석가 등 여러 직군이 데이터를 이용하려고 하고 있습니다. 하지만 쏘카 안에서 데이터가 다양한 형식으로 존재하기도 하고, 비개발 직군 입장에서는 DB에 직접 접근하는 것도 허들이 있었습니다. 따라서  "어떤 데이터를 어디서 찾아야 하는지", 혹은 "이 테이블의 데이터가 어떤 의미인지" 에 대한 질문을 기존에는 슬랙 채널을 이용하여 수기로 받았습니다. 이런 방식은 히스토리 파악도 쉽지 않고, 질문을 받아주는 리소스도 많이 소요되었습니다. 

(스크린샷)

메타데이터 플랫폼을 도입하면, 개발에 대한 도메인이 없더라도 간편한 UI 를 통해서 메타데이터를 확인할 수 있습니다.

https://www.netsuite.com/portal/resource/articles/erp/data-discovery.shtml

### Data Governance 의 관점 

기존에는 구글 시트 등에서 테이블과 칼럼에 대한 설명을 파편적으로 관리하곤 했습니다. 메타데이터 플랫폼을 도입하면 테이블 스키마, 코멘트가 중앙 관리될 수 있습니다. 이러한 여러 이유들 때문에 쏘카는 메타데이터 플랫폼을 도입하기로 결정했습니다. 

# 3. 메타데이터 플랫폼 비교분석 : Datahub vs Amundsen (60%)

## PoC 과정 소개

PoC 는 Proof Of Concept 의 준말로, 어떤 개념을 실제로 도입하기 전 테스트해보는 단계, 줄여서 찍먹(!) 이라고 생각하시면 됩니다. 메타데이터 플랫폼을 선정하기 전, 비교적 대중적이면서 공식 문서 등의 지원이 풍부힌 Datahub 와 Amundsen 을 선정하여 PoC를 하기로 결정했습니다. 

이 두 플랫폼을 직접 배포하고 다양한 시나리오를 테스트하면서 사용성, UI, 문서화, 권한, 인증 등 다양한 측면에서 비교분석을 진행했습니다. 이 글에서는 그 중 중요한 컨셉을 간추려서 소개드리려고 합니다.

## Datahub VS Amundsen 비교분석

![datathub-vs-amundsen](/img/metadata-platform-01/datahub-vs-amundsen.png)

### 1) 메타데이터 주입 방식

* Datahub는 yaml 파일을 실행하여 메타데이터를 주입합니다. yaml 파일은 기본적으로 10줄 내외이며, 실행할 때는 datahub CLI 를 사용합니다. 연결하는 데이터 소스에 따라 datahub 라이브러리에 따라오는 연결 플러그인 설치가 한두개 필요합니다.
* Amundsen 은 python script 를 실행하여 메타데이터를 주입합니다. 기본적으로 amundsen databuilder 라는 python 라이브러리 (ETL framework) 를 사용하며, Extract, Transform, Load 각 과정에 여러 자체 모듈을 끌어서 사용하는 방식입니다. 이 외에도 종종 여러 디펜던시가 필요했습니다. 코드 파일은 때에 따르지만 기본적으로 100 줄 이상이며, 읽기 헤비하다는 생각이 들었습니다. (공식 깃헙에 있는 샘플이 400줄이었습니다.)

### 2) UI

* Datahub 데모 사이트
* Amundsen 데모 사이트

UI는 각 플랫폼의 데모 사이트를 통해 확인하시는 게 가장 직관적일 것 같습니다. 내부 의견으로는 Datahub 이 훨씬 보기 편하다는 의견이 많았습니다.

### 3) 문서 기능

* Datahub 는 테이블 별 / 칼럼 별 태그 부여가 가능합니다.
* Amundsen 은 테이블 별 태그 부여가 가능합니다.

* Datahub 는 테이블 별 / 칼럼 별 풍부한 마크다운 문서 작성이 가능하고, 원본 소스의 description 을 보존합니다.
* Amundsen 역시 테이블 별 / 칼럼 별 마크다운 제한적인 문서 작성이 가능하고, 원본소스의 description 을 보존하지 않습니다.

중요한 점은, 플랫폼 UI 상에서 테이블 혹은 칼럼의 설명을 작성했을 때 원본 소스의 description 을 따로 확인할 수 있는지의 여부였습니다. Datahub 는 다음과 같은 방식으로 original description 을 동시에 보여주지만, Amundsen 은 딱히 그런 기능이 없었습니다. 또한 Datahub 는 원본 description 과 UI 상 description이 별개로 버전 관리가 되고 있어서, 한쪽의 수정이 다른 쪽에 영향을 끼치지 않았습니다. 

(스크린샷)



### 4) 오너십

* Datahub 는 테이블에 유저 / 그룹 단위로 오너십을 지정할 수 있습니다.
* Amundsen 은 테이블에 유저 단위로만 오너십을 지정할 수 있습니다.

### 5) 데이터 샘플링

Datahub 는 메타데이터 주입 시 사용하는 yaml 파일에서 SQL profiling 기능을 활성화 할 수 있습니다. 이 기능을 이용하면 컬럼 별 통계와 해당 컬럼의 샘플 데이터를 볼 수 있는데요. 현재는 이 기능은 보안상 사용하지 못하도록 막아두었습니다. Amundsen 은 pandas 를 연결하여 비슷한 기능을 구현할 수 있다고 합니다. 

### 6) 데이터 계보 (Data Lineage)

* Datahub의 경우, dbt와 datafold를 연동하여 데이터 계보를 시각화 할 수 있습니다.
* Amundsen 의 경우 datafold 를 연동할 수 있습니다.

dbt 는 데이터 ETL 과정에서 T(Transform) 과정을 효율화하는 도구입니다. 간단히 말해서, dbt 를 이용하면 SQL 쿼리 모듈화 및 재사용이 가능하고, 해당 파이프라인에서 정합성 관련 테스트를 시행할 수 있습니다. 데이터 엔지니어링 그룹 내에서 dbt 를 PoC 하고 있었기 때문에, 이 측면에서 Datahub 가 좀더 매력적으로 보였습니다. 

### 7) 인증 및 권한

* Datahub 는 SSO 로 keycloak, okta, google auth 를 지원합니다. 
* Amundsen 은 SSO 로 keycloack, okta, flask_oidc 를 지원합니다.
* Datahub 는 사용자 / 그룹 단위로 정책 부여가 가능합니다. 현재는 view 관련 권한은 설정할 수 없고, 테이블이나 컬럼에 대한 설명, 오너, 태그 들을 수정할 수 있는 edit 권한을 세부적으로 조정 가능합니다.
* Amundsen 은 아직 자체적으로 권한 설정을 지원하지 않습니다.

### 8) 데이터 소스 지원

* 두 플랫폼 모두 BigQuery , Mysql, DBT, AWS S3 등 대중적으로 쓰이는 데이터 소스를 지원합니다.
* Amundsen 은 pandas, neo4j 등의 조금 더 다양한 형태를 지원합니다. 

### 9) 서포트

* 공식 github repository 의 star 수를 비교했을 때 Datahub가 3.6K, Amundsen 이 2.6K 로 Datahub 가 좀더 우세했습니다.
* 두 플랫폼 모두 공식 슬랙, 웹사이트, github repository 등의 다양한 채널을 지원했으나, 슬랙에서 질답의 활발함이나 공식 문서의 체계성 측면에서 Datahub 가 좀더 우세했습니다.

# 4. 최종 결정 : Datahub 결정 이유 (15%) :white_check_mark:

## 사용성의 편리함 

가장 결정적인 이유는 사용성 차이였습니다. 사용성은 데이터 이용자와 플랫폼 개발자, 두 측면에서 생각할 수 있습니다.

데이터 이용자 측면에서는 위에서도 비교했듯이, Datahub 가 문서화, 오너십, 권한, 통계, 데이터 계보 관점에서 더 다양하고 풍부한 기능들을 지원합니다. 이런 기능들이 실제로 도입됐을 때, 이용자가 원하는 데이터를 빠르게 찾고 이해하는 데 더 많은 도움을 얻을 수 있을거라 판단했습니다.

플랫폼 개발자 측면에서도 메타데이터 주입 시 Datahub가 더 편리했습니다. 동일한 메타데이터를 주입한다고 가정했을 때 Datahub 는 10 줄 내외의 yaml 파일로 가능한 반면, Amundsen 은 100줄 이상의 python script가 필요했습니다. Amundsen script 가 긴 만큼 세세한 설정이 가능한지, 또 그런 세세한 설정이 가능하다고 해도 현재 상황에 필요한지를 고민해봤을 때는 의문점이 있었습니다. 따라서 쏘카의 상황에는 Datahub 가 더 적절하다고 판단했습니다. 

## UI 의 깔끔함

많은 사람이 이용하는 솔루션이나 플랫폼을 도입할때는 UI 도 무시할 수 없다고 생각합니다. PoC시 Datahub UI 가 훨씬 깔끔하다는 반응이 많았고, 매 버전마다 UI가 개선되고 있는 점도 Datahub으로 결정힌 이유 중 하나였습니다. 

## 빠르고 풍부한 서포트

Datahub 의 공식 슬랙 채널에는 현재 2000명이 넘는 사람이 활동하고 있고, 주제별로 분리된 다양한 채널에서 질답과 오류 대응이 활발하게 이루어지는 편입니다. 또한 새로운 기능을 제안 (feature request) 하는 채널도 따로 있어서, 사용자의 피드백을 풍부하게 반영하려는 노력이 느껴졌습니다. 이 뿐만 아니라 최근 발생한 Log4j 취약점 사태에도 빠르게 해당 취약점을 보완한 패치가 반영되고, 모든 진행 상황이 슬랙을 통해 공유되었습니다.

개인적인 경험으로는 공식 채널에 질문을 올리면 답이 안달리는 경우가 거의 없었던 것 같습니다. 국내에 메타데이터 플랫폼 관련 자료가 많지 않고, 팀에 합류하지 얼마 되지 않은 신입 엔지니어의 입장에서는 이런 활발한 서포트가 있다는 것이 매우 중요했습니다.

# 5. 마무리 & 다음편 예고 (5%) :white_check_mark:

이렇게 쏘카는 메타데이터 플랫폼으로 Datahub 을 선정하게 되었습니다. 다음 편에는 구체적으로 Datahub 를 어떻게 사내 인프라 환경에 구축했는지, 메타데이터 주입 방식을 어떻게 자동화하고 효율화 했는지 설명하려고 합니다.

혹시 신입 데이터 엔지니어가 어떤 일을 하는지 궁금하시다면, [쏘카 신입 데이터 엔지니어 디니의 4개월 회고](https://tech.socarcorp.kr/data/2021/12/28/data-engineering-team-onboarding.html) 에서 확인하실 수 있습니다. (데이터 엔지니어링팀이 데이터 엔지니어링 그룹으로 바뀌고 데이터 웨어하우스 팀, 데이터 플랫폼 팀, 모비딕 팀으로 세분화 되었어요.) 

긴 글 읽어주셔서 감사합니다. 그러면 다음 편에서 만나요! 